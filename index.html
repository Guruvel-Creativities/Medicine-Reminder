<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Doctor Panel - Medicine Reminder</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="max-w-5xl mx-auto mt-10 p-6 bg-white rounded-xl shadow-md">
    <!-- Login Section -->
    <div id="loginSection">
      <h2 class="text-2xl font-bold mb-4">Doctor Login</h2>
      <input type="email" id="email" placeholder="Email" class="border p-2 w-full mb-2">
      <input type="password" id="password" placeholder="Password" class="border p-2 w-full mb-2">
      <button onclick="login()" class="bg-blue-600 text-white px-4 py-2 rounded">Login</button>
    </div>

    <!-- Panel Section -->
    <div id="panelSection" style="display: none">
      <div class="flex justify-between items-center">
        <h2 class="text-2xl font-bold mb-4">Welcome to Doctor Panel</h2>
        <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded">Logout</button>
      </div>

      <!-- Medicine Schedule -->
      <h3 class="text-xl font-semibold mt-6 mb-2">Medicine Schedule Editor</h3>
      <div id="boxes" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Boxes will be added dynamically -->
      </div>

      <!-- Appointment Requests -->
      <h3 class="text-xl font-semibold mt-6 mb-2">Appointment Requests</h3>
      <div id="appointments" class="space-y-4">
        <!-- Appointments will be added here -->
      </div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCSmJ4mePkwBRUy2ZTwbZ5pBGkLaVc-R60",
      authDomain: "medicine-reminder-system-5f70c.firebaseapp.com",
      projectId: "medicine-reminder-system-5f70c",
      databaseURL: "https://medicine-reminder-system-5f70c-default-rtdb.asia-southeast1.firebasedatabase.app",
      storageBucket: "medicine-reminder-system-5f70c.appspot.com",
      messagingSenderId: "74756460982",
      appId: "1:74756460982:web:15c0fee07d55af5c91f117"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          document.getElementById("loginSection").style.display = "none";
          document.getElementById("panelSection").style.display = "block";
          window.scrollTo(0, 0);
          loadSchedule();
          loadAppointments();
        })
        .catch((err) => alert(err.message));
    }

    function logout() {
      auth.signOut();
      document.getElementById("loginSection").style.display = "block";
      document.getElementById("panelSection").style.display = "none";
      window.scrollTo(0, 0);
    }

    auth.onAuthStateChanged((user) => {
      if (user) {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("panelSection").style.display = "block";
        loadSchedule();
        loadAppointments();
      } else {
        document.getElementById("loginSection").style.display = "block";
        document.getElementById("panelSection").style.display = "none";
      }
    });

    function loadSchedule() {
      const boxesDiv = document.getElementById("boxes");
      boxesDiv.innerHTML = "";
      for (let i = 1; i <= 6; i++) {
        const boxDiv = document.createElement("div");
        boxDiv.className = "bg-gray-100 p-4 rounded shadow";

        const timeSelect = document.createElement("select");
        timeSelect.className = "w-full border p-2 mb-2";
        timeSelect.innerHTML = `<option value="">Select No. of Times</option>` +
          Array.from({ length: 5 }, (_, idx) => `<option value="${idx + 1}">${idx + 1} time(s)</option>`).join("");

        const timeInputsDiv = document.createElement("div");
        boxDiv.appendChild(document.createElement("h4")).innerText = `Box ${i}`;
        boxDiv.appendChild(timeSelect);
        boxDiv.appendChild(timeInputsDiv);

        timeSelect.addEventListener("change", () => {
          const times = parseInt(timeSelect.value);
          timeInputsDiv.innerHTML = "";
          for (let j = 1; j <= times; j++) {
            const timeInput = document.createElement("input");
            const label = document.createElement("label");
            const foodSel = document.createElement("select");

            label.innerText = `Time ${j}: `;
            timeInput.type = "time";
            timeInput.className = "border p-2 mr-2";
            foodSel.innerHTML = `<option value="Before Food">Before Food</option><option value="After Food">After Food</option>`;
            foodSel.className = "border p-2";

            const row = document.createElement("div");
            row.className = "mb-2";
            row.appendChild(label);
            row.appendChild(timeInput);
            row.appendChild(foodSel);
            timeInputsDiv.appendChild(row);
          }
        });

        boxesDiv.appendChild(boxDiv);
      }
    }

    function loadAppointments() {
      const appDiv = document.getElementById("appointments");
      appDiv.innerHTML = "";
      db.ref("appointments").once("value", (snapshot) => {
        snapshot.forEach((child) => {
          const data = child.val();
          const card = document.createElement("div");
          card.className = "p-4 border bg-white shadow-md";
          card.innerHTML = `<p><strong>Date:</strong> ${data.date}</p>
                            <p><strong>Time:</strong> ${data.time}</p>
                            <p><strong>Status:</strong> ${data.status || 'Pending'}</p>`;
          if (!data.status || data.status === 'Pending') {
            const accept = document.createElement("button");
            accept.className = "bg-green-500 text-white px-3 py-1 mr-2 rounded";
            accept.innerText = "Accept";
            accept.onclick = () => db.ref(`appointments/${child.key}/status`).set("Accepted");

            const reject = document.createElement("button");
            reject.className = "bg-red-500 text-white px-3 py-1 rounded";
            reject.innerText = "Reject";
            reject.onclick = () => db.ref(`appointments/${child.key}/status`).set("Rejected");

            card.appendChild(accept);
            card.appendChild(reject);
          }
          appDiv.appendChild(card);
        });
      });
    }
  </script>
</body>
</html>
