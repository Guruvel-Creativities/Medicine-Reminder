<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Doctor Panel - Medicine Reminder System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body class="bg-gray-100 p-6 font-sans">
  <div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-md">
    <h1 class="text-2xl font-bold mb-4">Doctor Panel - Medicine Reminder System</h1>

    <!-- Login Form -->
    <div id="loginSection">
      <input id="email" type="email" placeholder="Email" class="border p-2 rounded w-60 mb-2">
      <input id="password" type="password" placeholder="Password" class="border p-2 rounded w-60 mb-2">
      <button onclick="login()" class="bg-blue-600 text-white px-4 py-2 rounded">Login</button>
    </div>

    <!-- Logged-In UI -->
    <div id="panelSection" class="hidden">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Welcome, Doctor</h2>
        <button onclick="logout()" class="bg-red-500 text-white px-3 py-1 rounded">Logout</button>
      </div>

      <!-- Medicine Schedule -->
      <h3 class="text-lg font-bold mt-6 mb-2">Set Medicine Schedule</h3>
      <div id="scheduleContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>

      <!-- Appointment Requests -->
      <h3 class="text-lg font-bold mt-6 mb-2">Appointment Requests</h3>
      <div id="appointmentList" class="space-y-2"></div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "medicine-reminder-system-5f70c.firebaseapp.com",
      databaseURL: "https://medicine-reminder-system-5f70c-default-rtdb.firebaseio.com",
      projectId: "medicine-reminder-system-5f70c",
      storageBucket: "medicine-reminder-system-5f70c.appspot.com",
      messagingSenderId: "YOUR_MSG_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // Auth
    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          document.getElementById("loginSection").classList.add("hidden");
          document.getElementById("panelSection").classList.remove("hidden");
          loadSchedule();
          loadAppointments();
        })
        .catch(err => alert(err.message));
    }

    function logout() {
      auth.signOut().then(() => {
        document.getElementById("loginSection").classList.remove("hidden");
        document.getElementById("panelSection").classList.add("hidden");
      });
    }

    // Load Medicine Schedule UI
    function loadSchedule() {
      const container = document.getElementById("scheduleContainer");
      container.innerHTML = "";

      for (let i = 1; i <= 6; i++) {
        const boxId = `box${i}`;
        const div = document.createElement("div");
        div.className = "p-4 border rounded shadow";

        div.innerHTML = `
          <h4 class="font-semibold mb-2">Box ${i}</h4>
          <label class="block mb-1">No. of Times:</label>
          <input type="number" min="1" max="3" id="${boxId}_count" class="border p-1 w-full mb-2" value="1" onchange="updateTimeInputs('${boxId}')">

          <label class="block mb-1">Before/After Lunch:</label>
          <select id="${boxId}_timing" class="border p-1 w-full mb-2">
            <option value="Before">Before</option>
            <option value="After">After</option>
          </select>

          <div id="${boxId}_times"></div>
          <button onclick="saveSchedule('${boxId}')" class="mt-2 bg-green-500 text-white px-3 py-1 rounded">Save</button>
        `;

        container.appendChild(div);
        updateTimeInputs(boxId); // Initialize time input
      }
    }

    function updateTimeInputs(boxId) {
      const count = parseInt(document.getElementById(`${boxId}_count`).value);
      const container = document.getElementById(`${boxId}_times`);
      container.innerHTML = "";
      for (let i = 0; i < count; i++) {
        container.innerHTML += `<input type="time" id="${boxId}_time_${i}" class="border p-1 w-full mb-1" required>`;
      }
    }

    function saveSchedule(boxId) {
      const count = parseInt(document.getElementById(`${boxId}_count`).value);
      const timing = document.getElementById(`${boxId}_timing`).value;
      const times = [];

      for (let i = 0; i < count; i++) {
        times.push(document.getElementById(`${boxId}_time_${i}`).value);
      }

      db.ref(`schedule/${boxId}`).set({ count, timing, times })
        .then(() => alert(`Schedule saved for ${boxId}`))
        .catch(err => alert(err.message));
    }

    // Load Appointment Requests
    function loadAppointments() {
      const list = document.getElementById("appointmentList");
      db.ref("appointments").on("value", snapshot => {
        list.innerHTML = "";
        snapshot.forEach(child => {
          const data = child.val();
          const key = child.key;
          const div = document.createElement("div");
          div.className = "p-3 bg-gray-50 rounded border";

          div.innerHTML = `
            <strong>${data.date} at ${data.time}</strong> - Status: ${data.status || "Pending"}<br/>
            <button onclick="updateAppointment('${key}', 'Accepted')" class="bg-blue-500 text-white px-2 py-1 mt-1 mr-2 rounded">Accept</button>
            <button onclick="updateAppointment('${key}', 'Rejected')" class="bg-red-500 text-white px-2 py-1 mt-1 rounded">Reject</button>
          `;

          list.appendChild(div);
        });
      });
    }

    function updateAppointment(key, status) {
      db.ref(`appointments/${key}`).update({ status })
        .then(() => alert(`Appointment ${status}`))
        .catch(err => alert(err.message));
    }
  </script>
</body>
</html>
