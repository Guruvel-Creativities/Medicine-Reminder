<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doctor Panel - Medicine Reminder</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f9f9fb;
      margin: 0;
      padding: 0;
      color: #333;
    }

    header {
      background: #5c4d7d;
      color: white;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .container {
      padding: 20px;
    }

    h2 {
      margin-top: 20px;
      color: #5c4d7d;
    }

    .box-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .box {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px;
      background: #fff;
      flex: 1 0 30%;
      min-width: 300px;
    }

    .login-form, .panel-section {
      max-width: 600px;
      margin: 0 auto;
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    button {
      background-color: #5c4d7d;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #453b61;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>
  <header>
    <h1>Doctor Panel</h1>
    <button onclick="logout()">Logout</button>
  </header>

  <div class="container">
    <div class="login-form" id="loginForm">
      <h2>Login</h2>
      <input type="email" id="email" placeholder="Email">
      <input type="password" id="password" placeholder="Password">
      <button onclick="login()">Login</button>
    </div>

    <div id="mainPanel" class="hidden">
      <h2>Medicine Schedule</h2>
      <div class="box-container" id="scheduleBoxes">
        <!-- Boxes will be inserted here -->
      </div>
      <button onclick="saveSchedule()">Save Schedule</button>

      <h2>Appointments</h2>
      <div id="appointments"></div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCSmJ4mePkwBRUy2ZTwbZ5pBGkLaVc-R60",
      authDomain: "medicine-reminder-system-5f70c.firebaseapp.com",
      projectId: "medicine-reminder-system-5f70c",
      databaseURL: "https://medicine-reminder-system-5f70c-default-rtdb.asia-southeast1.firebasedatabase.app",
      storageBucket: "medicine-reminder-system-5f70c.appspot.com",
      messagingSenderId: "74756460982",
      appId: "1:74756460982:web:15c0fee07d55af5c91f117"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const loginForm = document.getElementById('loginForm');
    const mainPanel = document.getElementById('mainPanel');
    const scheduleBoxes = document.getElementById('scheduleBoxes');

    auth.onAuthStateChanged(user => {
      if (user) {
        loginForm.classList.add('hidden');
        mainPanel.classList.remove('hidden');
        loadSchedule();
        loadAppointments();
      } else {
        loginForm.classList.remove('hidden');
        mainPanel.classList.add('hidden');
      }
    });

    function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.signInWithEmailAndPassword(email, password).catch(alert);
    }

    function logout() {
      auth.signOut();
    }

    function loadSchedule() {
      scheduleBoxes.innerHTML = '';
      for (let i = 1; i <= 6; i++) {
        const box = document.createElement('div');
        box.className = 'box';
        box.innerHTML = `
          <h3>Box ${i}</h3>
          <input type="text" placeholder="Medicine Name" id="medName${i}">
          <select id="times${i}" onchange="showTimeFields(${i})">
            <option value="">No. of Times</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
          </select>
          <div id="timeFields${i}"></div>
        `;
        scheduleBoxes.appendChild(box);
      }
    }

    function showTimeFields(i) {
      const count = +document.getElementById(`times${i}`).value;
      const container = document.getElementById(`timeFields${i}`);
      container.innerHTML = '';
      for (let j = 1; j <= count; j++) {
        container.innerHTML += `
          <label>Time ${j}</label>
          <input type="time" id="time${i}_${j}">
          <select id="food${i}_${j}">
            <option value="before">Before Food</option>
            <option value="after">After Food</option>
          </select>
        `;
      }
    }

    function saveSchedule() {
      const schedule = {};
      for (let i = 1; i <= 6; i++) {
        const name = document.getElementById(`medName${i}`).value;
        const times = document.getElementById(`times${i}`).value;
        const doses = [];
        for (let j = 1; j <= times; j++) {
          const time = document.getElementById(`time${i}_${j}`).value;
          const food = document.getElementById(`food${i}_${j}`).value;
          doses.push({ time, food });
        }
        schedule[`Box${i}`] = { name, doses };
      }
      db.ref('medicineSchedule').set(schedule).then(() => alert("Schedule saved"));
    }

    function loadAppointments() {
      const container = document.getElementById('appointments');
      db.ref('appointments').on('value', snap => {
        container.innerHTML = '';
        const data = snap.val();
        for (let key in data) {
          const { date, time, status } = data[key];
          container.innerHTML += `
            <div class="box">
              <p><strong>Date:</strong> ${date}</p>
              <p><strong>Time:</strong> ${time}</p>
              <p><strong>Status:</strong> ${status}</p>
              <button onclick="updateStatus('${key}', 'accepted')">Accept</button>
              <button onclick="updateStatus('${key}', 'rejected')">Reject</button>
            </div>
          `;
        }
      });
    }

    function updateStatus(key, status) {
      db.ref(`appointments/${key}/status`).set(status);
    }
  </script>
</body>

</html>
